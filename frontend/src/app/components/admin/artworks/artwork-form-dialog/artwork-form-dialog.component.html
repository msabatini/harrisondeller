<div class="dialog-header">
  <h2 class="dialog-title">{{ isEditMode ? 'Edit' : 'Create' }} Artwork</h2>
</div>

<mat-dialog-content class="dialog-content">
  <div *ngIf="error" class="error-message">{{ error }}</div>

  <form (ngSubmit)="onSubmit()" class="form">
    <div class="form-field-wrapper">
      <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="18" x2="15" y2="18"/>
      </svg>
      <mat-form-field appearance="fill" class="full-width custom-field">
        <mat-label>Title *</mat-label>
        <input matInput [(ngModel)]="form.title" name="title" required>
      </mat-form-field>
    </div>

    <div class="form-field-wrapper">
      <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <path d="M 3 6 h 8 l 2 2 h 8 v 12 h -18 z" fill="none"/>
        <line x1="9" y1="11" x2="15" y2="11" opacity="0.6"/>
        <line x1="9" y1="15" x2="15" y2="15" opacity="0.6"/>
      </svg>
      <mat-form-field appearance="fill" class="full-width custom-field">
        <mat-label>Body of Work *</mat-label>
        <mat-select [(ngModel)]="form.bodyId" name="bodyId" required>
          <mat-option value="">Select a body of work...</mat-option>
          <mat-option *ngFor="let body of bodies" [value]="body._id">
            {{ body.title }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="form-field-wrapper">
      <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="4" y="2" width="16" height="20" rx="1"/>
        <line x1="7" y1="7" x2="17" y2="7"/>
        <line x1="7" y1="11" x2="17" y2="11"/>
        <line x1="7" y1="15" x2="14" y2="15"/>
      </svg>
      <mat-form-field appearance="fill" class="full-width custom-field">
        <mat-label>Description</mat-label>
        <textarea matInput [(ngModel)]="form.description" name="description" rows="3"></textarea>
      </mat-form-field>
    </div>

    <div class="form-row-container">
      <div class="form-field-wrapper form-row">
        <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="4" width="18" height="18" rx="1"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
          <line x1="7" y1="4" x2="7" y2="2"/>
          <line x1="17" y1="4" x2="17" y2="2"/>
          <circle cx="9" cy="15" r="1.5" fill="white" opacity="0.6"/>
          <circle cx="15" cy="15" r="1.5" fill="white" opacity="0.6"/>
        </svg>
        <mat-form-field appearance="fill" class="custom-field">
          <mat-label>Year</mat-label>
          <input matInput type="number" [(ngModel)]="form.year" name="year">
        </mat-form-field>
      </div>

      <div class="form-field-wrapper form-row">
        <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="4" y1="6" x2="20" y2="6"/>
          <line x1="4" y1="12" x2="20" y2="12"/>
          <line x1="4" y1="18" x2="20" y2="18"/>
          <polyline points="18 4 20 6 18 8" fill="none"/>
        </svg>
        <mat-form-field appearance="fill" class="custom-field">
          <mat-label>Order</mat-label>
          <input matInput type="number" [(ngModel)]="form.order" name="order" required>
        </mat-form-field>
      </div>
    </div>

    <div class="form-field-wrapper">
      <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="9" fill="none"/>
        <circle cx="12" cy="12" r="5" fill="none"/>
        <circle cx="12" cy="12" r="2" fill="white"/>
      </svg>
      <mat-form-field appearance="fill" class="full-width custom-field">
        <mat-label>Medium (e.g., Oil on Canvas)</mat-label>
        <input matInput [(ngModel)]="form.medium" name="medium">
      </mat-form-field>
    </div>

    <div class="form-field-wrapper">
      <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="5" width="18" height="12" rx="1"/>
        <line x1="5" y1="8" x2="5" y2="14" opacity="0.4"/>
        <line x1="8" y1="8" x2="8" y2="14" opacity="0.4"/>
        <line x1="11" y1="8" x2="11" y2="14" opacity="0.4"/>
        <line x1="14" y1="8" x2="14" y2="14" opacity="0.4"/>
        <line x1="17" y1="8" x2="17" y2="14" opacity="0.4"/>
      </svg>
      <mat-form-field appearance="fill" class="full-width custom-field">
        <mat-label>Dimensions (e.g., 24" x 36")</mat-label>
        <input matInput [(ngModel)]="form.dimensions" name="dimensions">
      </mat-form-field>
    </div>

    <!-- Image Upload Section -->
    <div class="image-upload-section">
      <div class="image-upload-header">
        <svg class="upload-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M 12 5 l -4 4 h 3 v 6 h 2 v -6 h 3 z"/>
          <path d="M 3 17 h 18" opacity="0.6"/>
          <rect x="4" y="17" width="16" height="2" rx="0.5" fill="white" opacity="0.3"/>
        </svg>
        <div class="image-upload-label">Upload Image *</div>
      </div>
      
      <div *ngIf="imagePreview" class="image-preview">
        <img [src]="imagePreview" alt="Preview">
        <button type="button" class="change-image-btn" (click)="fileInput.click()" [disabled]="uploading">
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M 23 19 a 2 2 0 0 1 -2 2 H 3 a 2 2 0 0 1 -2 -2 V 8 a 2 2 0 0 1 2 -2 h 4 l 2 -3 h 6 l 2 3 h 4 a 2 2 0 0 1 2 2 z"/>
            <circle cx="12" cy="13" r="4"/>
          </svg> Change Image
        </button>
      </div>

      <div *ngIf="!imagePreview" class="image-upload-box" (click)="fileInput.click()">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2"/>
          <circle cx="8.5" cy="8.5" r="1.5" fill="white"/>
          <path d="M 21 15 l -5 -5 L 5 21"/>
        </svg>
        <p>Click to upload image</p>
        <small>Supported formats: JPG, PNG, GIF, WebP (max 10MB)</small>
      </div>

      <input 
        #fileInput 
        type="file" 
        hidden 
        accept="image/*"
        (change)="onFileSelected($event)"
        [disabled]="uploading">

      <div *ngIf="uploading" class="uploading">
        <mat-spinner diameter="20"></mat-spinner>
        <span>Uploading...</span>
      </div>
    </div>

    <div class="toggle-group">
      <svg class="field-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3" fill="none"/>
        <path d="M 12 5 C 7 5 3 9 2 12 c 1 3 5 7 10 7 s 9 -4 10 -7 c -1 -3 -5 -7 -10 -7"/>
      </svg>
      <mat-slide-toggle [(ngModel)]="form.published" name="published">
        Published
      </mat-slide-toggle>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions>
  <button class="cancel-btn" (click)="onCancel()" [disabled]="loading || uploading">Cancel</button>
  <button 
    class="submit-btn"
    (click)="onSubmit()" 
    [disabled]="loading || uploading || !form.title.trim() || !form.imageUrl || !form.bodyId">
    <span *ngIf="!loading">{{ isEditMode ? 'Update' : 'Create' }}</span>
    <mat-spinner *ngIf="loading" diameter="20"></mat-spinner>
  </button>
</mat-dialog-actions>